<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Space Survivor: Universe</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        canvas { display: block; cursor: none; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .panel { position: absolute; pointer-events: all; background: rgba(5, 5, 20, 0.9); border: 2px solid #00f2ff; border-radius: 15px; padding: 25px; text-align: center; }
        #menu-ui { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; }
        .char-card { display: inline-block; width: 100px; padding: 10px; border: 1px solid #444; margin: 5px; cursor: pointer; transition: 0.3s; }
        .char-card:hover, .char-card.selected { border-color: #ff00ff; background: rgba(255, 0, 255, 0.1); }
        .btn { background: #00f2ff; color: #000; border: none; padding: 12px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; border-radius: 5px; }
        .stats { font-size: 0.8em; color: #aaa; text-align: left; margin: 10px 0; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div style="padding: 20px;">
            <h2 style="margin:0; color:#00f2ff;">SCORE: <span id="score">0</span></h2>
            <div id="multi-info" style="font-size: 0.8em; color: #ff00ff;">GHOST ACTIVE: <span id="ghost-score">0</span></div>
        </div>

        <div id="menu-ui" class="panel">
            <h1 style="color:#00f2ff; margin-top:0;">SELECT SHIP</h1>
            <div id="char-selection">
                <div class="char-card selected" onclick="selectChar('balance', this)">
                    <strong>Balance</strong><div class="stats">SPD: 5<br>ATK: 5</div>
                </div>
                <div class="char-card" onclick="selectChar('interceptor', this)">
                    <strong>Swift</strong><div class="stats">SPD: 8<br>ATK: 3</div>
                </div>
                <div class="char-card" onclick="selectChar('tanker', this)">
                    <strong>Titan</strong><div class="stats">SPD: 3<br>ATK: 8</div>
                </div>
            </div>
            <div id="shop-info" style="margin: 15px 0; font-size: 0.9em; border-top: 1px solid #333; padding-top: 10px;">
                TOTAL GOLD: <span id="gold-val" style="color:#ffd700">0</span>
            </div>
            <button class="btn" onclick="startGame()">START MISSION</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let saveData = JSON.parse(localStorage.getItem('spaceUnivData')) || {
            gold: 0, bestScore: 0, ghostPath: [], selectedId: 'balance'
        };
        const save = () => localStorage.setItem('spaceUnivData', JSON.stringify(saveData));

        let gameActive = false, score = 0, frame = 0;
        let bullets = [], enemies = [], currentPath = [];
        const player = { x: 0, y: 0, size: 15, type: 'balance' };

        // 캐릭터 스펙 정의
        const chars = {
            balance: { speed: 1, bulletColor: '#00f2ff', shield: false },
            interceptor: { speed: 1.5, bulletColor: '#ff00ff', shield: false },
            tanker: { speed: 0.7, bulletColor: '#ff4d4d', shield: true }
        };

        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            document.getElementById('gold-val').innerText = saveData.gold;
            document.getElementById('ghost-score').innerText = saveData.bestScore;
        }

        window.selectChar = (id, el) => {
            saveData.selectedId = id;
            document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            save();
        };

        window.startGame = () => {
            document.getElementById('menu-ui').style.display = 'none';
            score = 0; frame = 0; bullets = []; enemies = []; currentPath = [];
            player.type = saveData.selectedId;
            player.shield = chars[player.type].shield;
            gameActive = true;
            loop();
        };

        function loop() {
            if (!gameActive) return;
            frame++;
            ctx.fillStyle = 'rgba(0, 0, 10, 0.4)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 경로 기록 (유령용)
            currentPath.push({x: player.x, y: player.y});

            // 유령 그리기 (멀티플레이어 대용)
            if (saveData.ghostPath && saveData.ghostPath[frame]) {
                const gp = saveData.ghostPath[frame];
                ctx.globalAlpha = 0.3;
                ctx.fillStyle = '#fff';
                ctx.beginPath(); ctx.arc(gp.x, gp.y, 10, 0, Math.PI*2); ctx.fill();
                ctx.globalAlpha = 1.0;
            }

            // 플레이어 그리기 & 엔진 불꽃
            ctx.fillStyle = chars[player.type].bulletColor;
            ctx.beginPath();
            ctx.moveTo(player.x, player.y - 15);
            ctx.lineTo(player.x - 12, player.y + 12);
            ctx.lineTo(player.x + 12, player.y + 12);
            ctx.fill();
            if (player.shield) {
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 2;
                ctx.beginPath(); ctx.arc(player.x, player.y, 20, 0, Math.PI*2); ctx.stroke();
            }

            // 사격
            if (frame % 10 === 0) {
                bullets.push({x: player.x, y: player.y, v: -15, c: chars[player.type].bulletColor});
            }

            bullets.forEach((b, bi) => {
                b.y += b.v;
                ctx.fillStyle = b.c;
                ctx.fillRect(b.x - 2, b.y, 4, 12);
                if (b.y < 0) bullets.splice(bi, 1);
            });

            // 적 생성 및 충돌
            if (frame % 30 === 0) {
                enemies.push({x: Math.random() * canvas.width, y: -30, s: 20, h: 2});
            }

            enemies.forEach((e, ei) => {
                e.y += 4 + (score/5000);
                ctx.fillStyle = '#555';
                ctx.beginPath(); ctx.arc(e.x, e.y, e.s, 0, Math.PI*2); ctx.fill();

                bullets.forEach((b, bi) => {
                    if (Math.hypot(b.x - e.x, b.y - e.y) < e.s) {
                        e.h--; bullets.splice(bi, 1);
                        if (e.h <= 0) { enemies.splice(ei, 1); score += 100; saveData.gold += 5; }
                    }
                });

                if (Math.hypot(player.x - e.x, player.y - e.y) < e.s + player.size) {
                    if (player.shield) { player.shield = false; enemies.splice(ei, 1); }
                    else gameOver();
                }
            });

            document.getElementById('score').innerText = score;
            requestAnimationFrame(loop);
        }

        function gameOver() {
            gameActive = false;
            if (score > saveData.bestScore) {
                saveData.bestScore = score;
                saveData.ghostPath = currentPath;
            }
            save();
            alert("Mission Over. Score: " + score);
            init();
            document.getElementById('menu-ui').style.display = 'block';
        }

        window.addEventListener('mousemove', (e) => {
            const speed = chars[player.type].speed;
            // 부드러운 이동 보간
            player.x += (e.clientX - player.x) * 0.2 * speed;
            player.y += (e.clientY - player.y) * 0.2 * speed;
        });

        window.onload = init;
    </script>
</body>
</html>
